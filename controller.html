<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width,initial-scale=1"><title>C</title></head><body>
<h3>Controller</h3>
<textarea id="o" style="width:100%;height:100px" placeholder="Output"></textarea>
<textarea id="i" style="width:100%;height:100px" placeholder="Plak antwoord"></textarea>
<button onclick="send('jump')">Jump</button>
<button onclick="send('attack')">Attack</button>
<pre id="l"></pre>
<script>
let logQueue=[], logBusy=false, lastLog="", l=document.getElementById("l");
function log(t){ if(t!==lastLog){ logQueue.push(t); lastLog=t; if(!logBusy) flushLog(); } }
function flushLog(){
  logBusy=true;
  if(window.requestIdleCallback){
    requestIdleCallback(()=>{
      while(logQueue.length)l.textContent+=logQueue.shift()+"\n";
      logBusy=false;
    });
  } else {
    setTimeout(()=>{
      while(logQueue.length)l.textContent+=logQueue.shift()+"\n";
      logBusy=false;
    },0);
  }
}

let p=new RTCPeerConnection({iceServers:[], iceTransportPolicy:"all"});
let c=[], dc=p.createDataChannel("d",{ordered:false,maxRetransmits:0});
dc.onopen=()=>log("üü¢ Verbonden");
dc.onclose=()=>log("üî¥ Verbroken");
dc.onmessage=e=>log("‚¨ÖÔ∏è "+e.data);
p.onicecandidate=e=>{
  if(e.candidate)c.push(e.candidate.toJSON());
  else o.value=btoa(JSON.stringify({s:p.localDescription,c:c}));
};
p.createOffer().then(o=>p.setLocalDescription(o));
let o=document.getElementById("o"), i=document.getElementById("i");
i.oninput=()=>{try{
  let j=JSON.parse(atob(i.value.replace(/\s/g,'')));
  if(!p.remoteDescription)setRemote(j)
}catch{}};
function setRemote(j){
  p.setRemoteDescription(j.s);
  j.c.forEach(k=>p.addIceCandidate(new RTCIceCandidate(k)));
}
function send(m){
  if(dc.readyState==="open"){ dc.send(m); log("‚û°Ô∏è "+m); }
  else log("‚ùå Niet verbonden");
}
</script></body></html>
