<!DOCTYPE html>
<html><head><meta name="viewport" content="width=device-width, initial-scale=1"><title>Game</title></head><body>
<h2>Game</h2>
<textarea id="in" placeholder="Plak verbindingsstring van Controller" style="width:100%;height:100px;"></textarea><br>
<button onclick="start()">Verwerk + genereer antwoord</button><br><br>
<textarea id="out" placeholder="Stuur deze terug naar Controller" style="width:100%;height:100px;"></textarea><br>
<button onclick="copy('out')">Kopieer</button><br><pre id="log"></pre>
<script>
let pc, dc, cands=[];
function log(t){document.getElementById('log').textContent+=t+'\n'}
function copy(id){const t=document.getElementById(id);t.select();document.execCommand('copy')}
function start(){
  const d=JSON.parse(atob(document.getElementById('in').value.replace(/\s+/g,'')));
  pc=new RTCPeerConnection(); cands=[];
  pc.onicecandidate=e=>{if(e.candidate){cands.push(e.candidate.toJSON());output()}}
  pc.ondatachannel=e=>{
    dc=e.channel;
    dc.onopen=()=>log("open");
    dc.onmessage=ev=>{
      log("<< "+ev.data);
      if(ev.data=="jump")dc.send("gesprongen");
      else if(ev.data=="attack")dc.send("aanval");
      else dc.send("?");
    }
  };
  pc.setRemoteDescription(d.s).then(()=>{
    d.c.forEach(c=>pc.addIceCandidate(new RTCIceCandidate(c)))
    return pc.createAnswer()
  }).then(a=>pc.setLocalDescription(a))
}
function output(){
  const s=JSON.stringify({s:pc.localDescription, c:cands});
  document.getElementById('out').value=btoa(s)
}
</script>
</body></html>
