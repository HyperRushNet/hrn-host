<!DOCTYPE html>
<html>
<head>
  <title>Scan Code</title>
  <style>
    video, canvas { border: 1px solid black; margin-top: 10px; }
    textarea { width: 100%; height: 80px; }
  </style>
</head>
<body>
<h2>Code Scanner</h2>
<video id="video" width="256" height="256" autoplay></video><br>
<canvas id="scanCanvas" width="256" height="256" style="display:none;"></canvas><br>
<button onclick="scanCode()">Scan</button><br><br>
<textarea id="outputText" placeholder="Gescande output..."></textarea>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('scanCanvas');
const ctx = canvas.getContext('2d');

navigator.mediaDevices.getUserMedia({ video: { width: 256, height: 256 } })
  .then(stream => video.srcObject = stream);

function scanCode() {
  ctx.drawImage(video, 0, 0, 256, 256);
  const imageData = ctx.getImageData(0, 0, 256, 256).data;
  const size = 32;
  const cellSize = 8;
  let bits = "";

  for (let y = 0; y < size; y++) {
    for (let x = 0; x < size; x++) {
      let index = ((y * cellSize + cellSize / 2) * 256 + (x * cellSize + cellSize / 2)) * 4;
      let r = imageData[index];
      let g = imageData[index + 1];
      let b = imageData[index + 2];
      let avg = (r + g + b) / 3;
      bits += avg < 128 ? "1" : "0";
    }
  }

  let output = "";
  for (let i = 0; i < bits.length; i += 8) {
    const byte = bits.slice(i, i + 8);
    if (byte.length === 8) {
      output += String.fromCharCode(parseInt(byte, 2));
    }
  }

  try {
    const decoded = decodeURIComponent(escape(atob(output)));
    document.getElementById("outputText").value = decoded;
  } catch (e) {
    document.getElementById("outputText").value = "Fout bij decoderen";
  }
}
</script>
</body>
</html>
